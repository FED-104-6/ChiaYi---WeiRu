<div class="messages-container">
  <!-- 篩選器區塊 -->
  <div class="filter-section">
    <label>
      Leave a message from:
      <input type="date" [(ngModel)]="filter.startDate" />
    </label>
    <span>~</span>
    <label>
      Leave a message until:
      <input type="date" [(ngModel)]="filter.endDate" />
    </label>

    <label>
      State:
      <select [(ngModel)]="filter.status">
        <option value="">All</option>
        <option value="replied">Processed</option>
        <option value="unreplied">Unprocessed</option>
      </select>
    </label>

    <button class="search-btn" (click)="applyFilter()">Search</button>
  </div>

  <!-- 訊息列表 -->
  <div class="table-wrapper">
    <table class="messages-table">
      <thead>
        <tr>
          <th style="width: 64px;"></th>
          <th>Users</th>
          <th>Title</th>
          <th>Question</th>
          <th>State</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let msg of pagedMessages; let i = index">
          <td class="text-center">{{ i + 1 + (currentPage-1)*itemsPerPage }}</td>
          <td>{{ msg.username }}</td>
          <td>{{ msg.title }}</td>
          <td>{{ msg.shortContent || msg.content }}</td>
          <td>
            <span [class.replied]="msg.status === 'replied'"
                  [class.unreplied]="msg.status === 'unreplied'">
              {{ msg.status === 'replied' ? 'Processed' : 'Unprocessed' }}
            </span>
          </td>
          <td>
            <button class="edit-btn" (click)="openEditModal(msg, i)">Reply</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- 分頁控制 -->
  <div class="pagination">
    <button (click)="prevPage()" [disabled]="currentPage === 1">&lt;</button>
    <span>{{ currentPage }} / {{ totalPages }}</span>
    <button (click)="nextPage()" [disabled]="currentPage === totalPages">&gt;</button>
  </div>

  <!-- 回覆 Modal -->
  <div class="modal-backdrop" *ngIf="editingMessage">
    <div class="modal">
      <h3>Reply to message</h3>
      <label>
        User:
        <span>{{ editingMessage.username }}</span>
      </label>
  
      <label>
        Question:
        <p>{{ editingMessage.content }}</p>
      </label>
  
      <label>
        Reply:
        <textarea [(ngModel)]="editingMessage.reply"></textarea>
      </label>
  
      <label>
        State:
        <select [(ngModel)]="editingMessage.status">
          <option value="replied">Processed</option>
          <option value="unreplied">Unprocessed</option>
        </select>
      </label>
  
      <div class="modal-buttons">
        <button class="save-btn" (click)="saveEdit()">Save</button>
        <button class="delete-btn" (click)="deleteMessage()">Delete</button>
        <button class="cancel-btn" (click)="cancelEdit()">Cancel</button>
      </div>
    </div>
  </div>
</div>
